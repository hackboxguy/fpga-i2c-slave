# Xilinx Spartan-7 XC7S50 Pin Constraints
# I2C Slave Implementation - Optimized for high-speed operation
# Target: XC7S50-CSGA324-1 (Local Dimming Display Driver Board)

# 50MHz differential clock input (DDR_50M_CLKP/CLKN)
# Generated by DS90LV011AQ LVDS driver from 50MHz oscillator
# Using LVDS_25 differential input on C12 (positive) and C11 (negative)
set_property -dict {PACKAGE_PIN C12 IOSTANDARD LVDS_25} [get_ports clk_p]
set_property -dict {PACKAGE_PIN C11 IOSTANDARD LVDS_25} [get_ports clk_n]
set_property DIFF_TERM TRUE [get_ports clk_p]
create_clock -period 20.000 -name sys_clk [get_ports clk_p]

# LED output - M18 (corrected pin)
set_property -dict {PACKAGE_PIN M18 IOSTANDARD LVCMOS33 DRIVE 8 SLEW SLOW} [get_ports led]

# I2C SCL pin - R14 (original pin)
set_property -dict {PACKAGE_PIN R14 IOSTANDARD LVCMOS33} [get_ports scl]
set_property PULLUP true [get_ports scl]

# I2C SDA pin - T14 (original pin)
# Note: External pull-ups present on board
set_property -dict {PACKAGE_PIN T14 IOSTANDARD LVCMOS33} [get_ports sda]
set_property PULLUP true [get_ports sda]

# I2C timing constraints for 400kHz operation
# Input delay constraints (based on I2C specification)
set_input_delay -clock sys_clk -min 0.0 [get_ports {scl sda}]
set_input_delay -clock sys_clk -max 10.0 [get_ports {scl sda}]

# Output delay constraints for SDA
set_output_delay -clock sys_clk -min -2.0 [get_ports sda]
set_output_delay -clock sys_clk -max 12.0 [get_ports sda]

# Maximum delay constraints for synchronizers
set_max_delay -from [get_ports scl] -to [get_cells -hier -filter {NAME =~ *scl_sync*}] 10.0
set_max_delay -from [get_ports sda] -to [get_cells -hier -filter {NAME =~ *sda_sync*}] 10.0

# Multicycle path for timeout counter (not timing-critical)
set_multicycle_path -setup 2 -from [get_cells -hier -filter {NAME =~ *scl_timeout*}] -to [get_cells -hier -filter {NAME =~ *scl_timeout*}]
set_multicycle_path -hold 1 -from [get_cells -hier -filter {NAME =~ *scl_timeout*}] -to [get_cells -hier -filter {NAME =~ *scl_timeout*}]

# False path for asynchronous reset counter
set_false_path -from [get_cells -hier -filter {NAME =~ *reset_counter*}]

# Additional Xilinx-specific optimizations
set_property CLOCK_DEDICATED_ROUTE FALSE [get_nets scl_IBUF]
